<div class="card">
  <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
    <h5 class="mb-0">
      <i class="fas fa-money-bill-wave me-2"></i>Salary Structures
    </h5>
    <button class="btn btn-light btn-sm" routerLink="/admin/payroll/structures/add">
      <i class="fas fa-plus"></i> Add Salary Structure
    </button>
  </div>
  <div class="card-body">
    
    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-2">Loading salary structures...</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage && !isLoading" class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ errorMessage }}
      <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadSalaryStructures()">
        <i class="fas fa-redo me-1"></i> Retry
      </button>
    </div>

    <!-- Content -->
    <div *ngIf="!isLoading && !errorMessage">
      <!-- Search Filter -->
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input type="text" class="form-control" placeholder="Search by employee name, code or department..." 
                   [(ngModel)]="searchTerm" (input)="applyFilters()">
          </div>
        </div>
        <div class="col-md-6">
          <div class="d-flex justify-content-end">
            <span class="badge bg-success me-2">Active: {{ filteredActiveCount }}</span>
            <span class="badge bg-secondary">Filtered: {{ filteredStructures.length }}</span>
            <span class="badge bg-primary ms-2">Total: {{ salaryStructures.length }}</span>
          </div>
        </div>
      </div>

      <!-- Salary Structures Table -->
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>Employee</th>
              <th>Department</th>
              <th>Designation</th>
              <th>Basic Salary</th>
              <th>Allowances</th>
              <th>Deductions</th>
              <th>Net Salary</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let structure of filteredStructures">
              <td>
                <div class="fw-bold">{{ structure.employeeName }}</div>
                <small class="text-muted">{{ structure.employeeCode }}</small>
              </td>
              <td>{{ structure.departmentName }}</td>
              <td>{{ structure.designation }}</td>
              <td class="fw-bold text-primary">{{ formatCurrency(structure.basicSalary) }}</td>
              <td>
                <small class="text-success">
                  +{{ formatCurrency(structure.houseRent + structure.medicalAllowance + structure.transportAllowance + structure.otherAllowances) }}
                </small>
              </td>
              <td>
                <small class="text-danger">
                  -{{ formatCurrency(structure.totalDeductions) }}
                </small>
              </td>
              <td class="fw-bold text-success">{{ formatCurrency(structure.netSalary) }}</td>
              <td>
                <span [class]="getStatusBadgeClass(structure.status)">
                  {{ structure.status }}
                </span>
              </td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-primary" 
                          [routerLink]="['/admin/payroll/structures/edit', structure.id]">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-outline-info" 
                          [routerLink]="['/admin/payroll/process']" 
                          [queryParams]="{employeeId: structure.employeeId}">
                    <i class="fas fa-calculator"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredStructures.length === 0 && salaryStructures.length > 0">
              <td colspan="9" class="text-center text-muted py-4">
                <i class="fas fa-search fa-2x mb-3"></i>
                <p>No salary structures match your search criteria</p>
              </td>
            </tr>
            <tr *ngIf="salaryStructures.length === 0">
              <td colspan="9" class="text-center text-muted py-4">
                <i class="fas fa-money-bill-wave fa-2x mb-3"></i>
                <p>No salary structures found</p>
                <a routerLink="/admin/payroll/structures/add" class="btn btn-primary btn-sm">
                  Create First Salary Structure
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Summary Cards -->
      <div class="row mt-4">
        <div class="col-md-3">
          <div class="card bg-primary text-white">
            <div class="card-body text-center">
              <h4>{{ formatCurrency(totalBasicSalary) }}</h4>
              <p class="mb-0">Total Basic Salary</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-success text-white">
            <div class="card-body text-center">
              <h4>{{ formatCurrency(totalNetSalary) }}</h4>
              <p class="mb-0">Total Net Salary</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-info text-white">
            <div class="card-body text-center">
              <h4>{{ activeStructuresCount }}</h4>
              <p class="mb-0">Active Structures</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card bg-warning text-white">
            <div class="card-body text-center">
              <h4>{{ salaryStructures.length }}</h4>
              <p class="mb-0">Total Structures</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>