<div class="container-fluid">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="mb-1">User Management</h2>
      <p class="text-muted mb-0">Manage system users and their roles</p>
    </div>
    <a routerLink="/admin/users/add" class="btn btn-primary">
      <i class="fas fa-user-plus me-2"></i>Add New User
    </a>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fas fa-exclamation-circle me-2"></i>
    {{ error }}
    <button type="button" class="btn-close" (click)="error = ''"></button>
  </div>

  <!-- Filters Card -->
  <div class="card shadow mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <label for="search" class="form-label">Search Users</label>
          <input
            type="text"
            class="form-control"
            id="search"
            placeholder="Search by username, name, or email..."
            [(ngModel)]="searchTerm"
            (input)="currentPage = 1">
        </div>
        <div class="col-md-4">
          <label for="roleFilter" class="form-label">Filter by Role</label>
          <select
            class="form-select"
            id="roleFilter"
            [(ngModel)]="roleFilter"
            (change)="currentPage = 1">
            <option value="">All Roles</option>
            <option value="ROLE_ADMIN">Administrator</option>
            <option value="ROLE_MANAGER">Manager</option>
            <option value="ROLE_HR">HR Manager</option>
            <option value="ROLE_ACCOUNTANT">Accountant</option>
            <option value="ROLE_EMPLOYEE">Employee</option>
          </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
          <button class="btn btn-outline-secondary w-100" (click)="clearFilters()">
            <i class="fas fa-times me-1"></i>Clear
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="card shadow">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">
        Users ({{ totalItems }})
      </h6>
    </div>
    <div class="card-body">
      <!-- Loading Spinner -->
      <div *ngIf="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading users...</p>
      </div>

      <!-- Users Table -->
      <div *ngIf="!loading" class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead class="table-light">
            <tr>
              <th>User</th>
              <th>Contact</th>
              <th>Roles</th>
              <th>Employee Info</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of paginatedUsers">
              <!-- User Info -->
              <td>
                <div class="d-flex align-items-center">
                  <div class="avatar bg-primary text-white rounded-circle me-3">
  {{ getAvatarText(user) }}
</div>
                  <div>
                    <strong>{{ user.fullName }}</strong>
                    <div class="text-muted small">@{{ user.username }}</div>
                  </div>
                </div>
              </td>

              <!-- Contact -->
              <td>
                <div>{{ user.email }}</div>
                <small class="text-muted">
                  Created: {{ user.createdAt | date:'mediumDate' }}
                </small>
              </td>

              <!-- Roles -->
              <td>
                <div *ngFor="let role of user.roles" class="mb-1">
                  <span class="badge" [ngClass]="{
                    'bg-danger': role === 'ROLE_ADMIN',
                    'bg-warning': role === 'ROLE_MANAGER',
                    'bg-info': role === 'ROLE_HR',
                    'bg-success': role === 'ROLE_ACCOUNTANT',
                    'bg-secondary': role === 'ROLE_EMPLOYEE'
                  }">
                    {{ getRoleDisplayName(role) }}
                  </span>
                </div>
              </td>

              <!-- Employee Info -->
              <td>
                <div *ngIf="user.employeeCode" class="small">
                  <div><strong>ID:</strong> {{ user.employeeCode }}</div>
                  <div *ngIf="user.designation"><strong>Role:</strong> {{ user.designation }}</div>
                  <div *ngIf="user.departmentName"><strong>Dept:</strong> {{ user.departmentName }}</div>
                </div>
                <div *ngIf="!user.employeeCode" class="text-muted small">
                  No employee record
                </div>
              </td>

              <!-- Status -->
              <td>
                <span class="badge" [ngClass]="user.active ? 'bg-success' : 'bg-danger'">
                  {{ user.active ? 'Active' : 'Inactive' }}
                </span>
              </td>

              <!-- Actions -->
              <td>
                <div class="btn-group btn-group-sm">
                  <a 
                    [routerLink]="['/admin/users/edit', user.id]" 
                    class="btn btn-outline-primary"
                    title="Edit User">
                    <i class="fas fa-edit"></i>
                  </a>
                  <button 
                    type="button" 
                    class="btn" 
                    [ngClass]="user.active ? 'btn-outline-warning' : 'btn-outline-success'"
                    (click)="toggleUserStatus(user)"
                    [title]="user.active ? 'Deactivate User' : 'Activate User'">
                    <i class="fas" [ngClass]="user.active ? 'fa-user-slash' : 'fa-user-check'"></i>
                  </button>
                  <button 
                    type="button" 
                    class="btn btn-outline-danger"
                    (click)="deleteUser(user)"
                    title="Delete User">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>

            <!-- Empty State -->
            <tr *ngIf="filteredUsers.length === 0">
              <td colspan="6" class="text-center py-4">
                <i class="fas fa-users fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No users found</h5>
                <p *ngIf="searchTerm || roleFilter" class="text-muted">
                  Try adjusting your search criteria
                </p>
                <a *ngIf="!searchTerm && !roleFilter" routerLink="/admin/users/add" class="btn btn-primary mt-2">
                  <i class="fas fa-user-plus me-2"></i>Add First User
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="!loading && totalPages > 1" class="d-flex justify-content-between align-items-center mt-4">
       <div class="text-muted">
  Showing {{ getDisplayRange().start }} to {{ getDisplayRange().end }} of {{ totalItems }} entries
</div>
        <nav>
          <ul class="pagination mb-0">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="changePage(currentPage - 1)">Previous</a>
            </li>
            
            <li *ngFor="let page of [].constructor(totalPages); let i = index" 
                class="page-item" 
                [class.active]="currentPage === i + 1">
              <a class="page-link" (click)="changePage(i + 1)">{{ i + 1 }}</a>
            </li>
            
            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <a class="page-link" (click)="changePage(currentPage + 1)">Next</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>